<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- Generated by Apache Maven Doxia at Jul 28, 2010 -->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>AN01_PatternTab - 
    Documenti</title>
    <style type="text/css" media="all">
      @import url("../../css/maven-base.css");
      @import url("../../css/maven-theme.css");
      @import url("../../css/site.css");
    </style>
    <link rel="stylesheet" href="../../css/print.css" type="text/css" media="print" />
      <meta name="author" content="Andrea Salicetti" />
    <meta name="Date-Revision-yyyymmdd" content="20100728" />
    <meta http-equiv="Content-Language" content="en" />
        
  </head>
  <body class="composite">
    <div id="banner">
                    <div id="bannerLeft">
                Gestione Documentale
                </div>
                    <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="breadcrumbs">
            
        
                <div class="xleft">
        <span id="publishDate">Last Published: 2010-07-28</span>
                  &nbsp;| <span id="projectVersion">Version: 1.0-SNAPSHOT</span>
                      </div>
            <div class="xright">                    <a href="http://siaweb.kion.it:8887/sia-pr/" class="externalLink" title="Ambiente di test su HEAD">Ambiente di test su HEAD</a>
              
        
      </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="leftColumn">
      <div id="navcolumn">
             
        
                                <h5>Workflow</h5>
                  <ul>
                  <li class="none">
                          <a href="../../index.html" title="Introduzione">Introduzione</a>
            </li>
                  <li class="none">
                          <a href="../../visione.html" title="Visione">Visione</a>
            </li>
                  <li class="none">
                          <a href="../../obiettivi.html" title="Obiettivi">Obiettivi</a>
            </li>
                                                                                                                                            <li class="collapsed">
                          <a href="../../requisiti.html" title="Requisiti">Requisiti</a>
                  </li>
                                                                                                                                                  <li class="collapsed">
                          <a href="../../analisi.html" title="Analisi">Analisi</a>
                  </li>
                  <li class="none">
                          <a href="../../pianoDiLavoro.html" title="Piano di lavoro">Piano di lavoro</a>
            </li>
                                                                                                                                                  <li class="collapsed">
                          <a href="../../progetto.html" title="Progetto">Progetto</a>
                  </li>
                                                                                                                  <li class="expanded">
                          <a href="../../implementazione.html" title="Implementazione">Implementazione</a>
                    <ul>
                      <li class="none">
                          <a href="../../implementazione/impl_00.html" title="Creazione del progetto">Creazione del progetto</a>
            </li>
                                                                            <li class="expanded">
                          <a href="../../implementazione/UC01/impl_uc01.html" title="Caso d'uso UC01">Caso d'uso UC01</a>
                    <ul>
                      <li class="none">
            <strong>Una prima soluzione</strong>
          </li>
              </ul>
        </li>
              </ul>
        </li>
                  <li class="none">
                          <a href="../../esecuzione.html" title="Esecuzione">Esecuzione</a>
            </li>
          </ul>
                       <h5>Code</h5>
                  <ul>
                  <li class="none">
                          <a href="../../xref/index.html" target="_blanalisik" title="Sorgenti">Sorgenti</a>
            </li>
                  <li class="none">
                          <a href="../../xref-test/index.html" target="_blanalisik" title="Sorgenti dei test">Sorgenti dei test</a>
            </li>
                  <li class="none">
                          <a href="../../dependencies.html" title="Dipendenze">Dipendenze</a>
            </li>
          </ul>
                       <h5>Report</h5>
                  <ul>
                  <li class="none">
                          <a href="../../apidocs/index.html" title="JavaDocs">JavaDocs</a>
            </li>
                  <li class="none">
                          <a href="../../junit-report/surefire-report.html" title="JUnit Report">JUnit Report</a>
            </li>
          </ul>
                       <h5>Workers</h5>
                  <ul>
                  <li class="none">
                          <a href="../../team-list.html" title="Team">Team</a>
            </li>
          </ul>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="poweredBy" alt="Built by Maven" src="../../images/logos/maven-feather.png" />
      </a>
                   
        
            </div>
    </div>
    <div id="bodyColumn">
      <div id="contentBox">
         
  
		<p>
			Ora implementeremo una versione embrionale della gestione dei documenti, abbozzando una realizzazione al caso d'uso [UC01]. 
 		</p>
	<div class="section"><h2>Scaffolding dell'entit&#xe0; Documento<a name="Scaffolding_dellentit_Documento"></a></h2>
		<p>Dato il modello sintetizzato in analisi:</p>
		<div class="img width50">
			<img src="../../images/documento_UML.png" alt="Documento - Struttura." />
			<div class="title"><b>[Fig.1]</b> Documento - Struttura.</div>
		</div>
		<p>Possiamo creare tutte le risorse ad esso legate:</p>
		<div class="console">
			rails g scaffold document body:text creator_id:integer revisor_id:integer expire_on:date
		</div>
		<p>Nel comando precedente abbiamo dichiarato le propriet&#xe0; (e i relativi tipi) associate al modello <b>document</b>.</p>
		<div class="nota">
			Si notino questi tre aspetti:
			<ol style="list-style-type: decimal">
				<li>Non abbiamo specificato il campo di chiave <tt>id</tt>: Rails lo crea per noi automaticamente sempre e gli da, convenzionalmente, proprio il nome <tt>id</tt>.<br /></li>
				<li>La nomenclatura di classi e propriet&#xe0; &#xe8; anglosassone. Non &#xe8; obbligatorio che sia cos&#xec;, ma semplifica nettamente lo sviluppo, in quanto Rails parla inglese e possiede gi&#xe0; nativamente delle regole (dette <i>inflections</i>) che gli consentono di stabilire automaticamente che ad un modello denominato <tt>document</tt> dovr&#xe0; corrispondere una tabella denominata <tt>documents</tt>.</li>
			</ol>
		</div>
		<p>Come possiamo evincere anche esaminando l'output del comando, Rails ha creato per noi:</p>
		<ul>
			<li>I file di <b>migrazione</b> del DB per il setup della tabella <tt>DOCUMENTS</tt>.</li>
			<li>La <b>classe di modello</b> <tt>Docuement</tt>.</li>
			<li>Il <b>controller</b> per la gestione dei record di tipo <i>Document</i>.</li>
			<li>I <b>template</b> delle viste e dei partial relativi.</li>
			<li>La classe <b>helper</b> relativa.</li>
			<li>Un foglio di stile.</li>
			<li>Le risorse necessarie ai <b>test</b> sui documenti:
				<ul>
					<li>Classe per la definizione dei <b>test unitari</b>.</li>
					<li>Descrittore di <b>fixture</b> per popolare la tabella documents con dei record di test.</li>
					<li>Classe per la definizione dei <b>test funzionali</b>.</li>
					<li>Classe per la definizione dei <b>test di acceptance</b>.</li>
				</ul>
			</li>
		</ul>
		<div class="section"><h3>Allienamento DB<a name="Allienamento_DB"></a></h3>
			<p>Ogni volta che si interviene sulla struttura di uno o pi&#xf9; modelli, occorre ricordarsi di rilanciare le migrations per assicurarsi che le nuove fix introdotte modifichino lo schema su DB in modo tale da riflettere il modello a livello applicativo.</p>
			<p>Facciamolo, dunque, lanciando:</p>
			<div class="console">
				rake db:migrate
			</div>
			<p>
				Ora la tabella documents esiste sul DB.
			</p>
		</div>
		<div class="section"><h3>Risultato<a name="Risultato"></a></h3>
			<p>Proviamo a vedere il risultato.</p>
			<p>Lanciamo il server:</p>
			<div class="console">
				rails s
			</div>
			<p>
			e puntiamo all'URL <a class="newWindow" href="http://localhost:3000/documents" target="_blank">http://localhost:3000/documents</a>.</p>
			<div class="img">
				<img src="../../images/UC01/documenti_I_versione.png" alt="L'applicazione funzionante" />
			<div class="title"><b>[Fig.1]</b> L'applicazione funzionante.</div>
				</div>
		</div>
		<div class="section"><h3>Un tocco di stile<a name="Un_tocco_di_stile"></a></h3>
		<p>
			Considerazioni:
		</p>
		<ul>
			<li>Funziona!</li>
			<li>Fa pena...</li>
		</ul>
		<p>Non perdo tempo ora sul layout, voglio prototipare rapidamente, per&#xf2; non posso presentare al cliente una cosa simile.</p>
		<p>Uso un <a class="newWindow" href="http://github.com/ryanb/nifty-generators" target="_blank">generatore apposito</a> per portare provvisoriamente il layout a livelli presentabili; occorrono tre passi</p>
		<ol style="list-style-type: decimal">
			<li>Dichiarazione di dipendenza:
			<table border="0" class="CodeRay"><tr class="a">

  <td class="line_numbers"><div><pre><a href="#n1">1</a>
<a href="#n2">2</a>
<a href="#n3">3</a>
<a href="#n4">4</a>
</pre></div></td>
  <td class="code"><div><pre><span title="Ident">group</span> <span title="Symbol" class="sy">:development</span> <span title="Reserved" class="r">do</span>
   <span title="Ident"><span class="highlight">gem</span></span> <span title="String" class="s"><span title="Content" class="highlight">'nifty-generators'</span></span>
   <span title="Ident">...</span>
<span title="Reserved" class="r">end</span>
</pre></div></td>
</tr></table>

			</li>
			<li>Recupero dipendenze:
				<div class="console">bundle install</div>			
			</li>
			<li>Uso del nuovo generatore:
				<div class="console">rails g nifty:layout</div>			
			</li>
		</ol>
		<p>controllando ora, ci accorgiamo che l'aspetto &#xe8; decisamente migliorato:</p>
					<div class="img">
				<img src="../../images/UC01/documenti_II_versione.png" alt="La maschera dei documenti dopo l'aggiunta degli stili" />
			<div class="title"><b>[Fig.2]</b> La maschera dei documenti dopo l'aggiunta degli stili.</div>
				</div>
		</div>
		<div class="section"><h3>Aggiungiamo qualche vincolo sul modello<a name="Aggiungiamo_qualche_vincolo_sul_modello"></a></h3>
			<p>Sistemato provvisoriamente lo stile, possiamo giocare un po' con quanto abbiamo prodotto fino ad ora, per renderci conto che l'applicazione &#xe8; gi&#xe0; in grado di compiere tutte le operazioni di CRUD sulla tabella relativa ai documenti.</p>
			<p>Prima di affrontare il discorso <i>tag</i> ed <i>editor</i> e rivedere il modello document per rappresentare opportunamente le relazioni, occupiamoci brevemente dei vincoli sul modello appena creato.</p>
			<p>Facendo qualche prova, notiamo come sia possibile creare un documento <u>anche senza specificare alcun campo</u>.</p>
			<p>Questo ovviamente non va bene, essendo i campi <tt>body</tt> <tt>creator_id</tt> ed <tt>expire_on</tt> <b>obbligatori</b> da specifiche.</p>
			<p>
				Per fortuna, Rails ci aiuta anche in questo.
			</p>
			<p>Si tratta di vincoli sul modello, quindi in Rails, naturalmente, si impongono sulla classe di modello (e basta):</p>
			<div class="filename">app/models/document.rb</div>
			<table border="0" class="CodeRay">
			<tbody><tr class="a">
  <td class="line_numbers"><div><pre><a href="#n1">1</a>
<a href="#n2">2</a>
<a href="#n3">3</a>
</pre></div></td>
  <td class="code"><div><pre><span title="Reserved" class="r">class</span> <span title="Class" class="cl">Document</span> <span title="Operator">&lt;</span> <span title="Constant" class="co">ActiveRecord</span><span title="Operator">::</span><span title="Constant" class="co">Base</span>
  <span title="Ident">validates_presence_of</span> <span title="Operator">[</span><span title="Symbol" class="sy">:body</span><span title="Operator">,</span> <span title="Symbol" class="sy">:creator_id</span><span title="Operator">]</span>
<span title="Reserved" class="r">end</span></pre></div></td>
</tr></tbody></table>
		</div>
		<p>Per ora siamo a posto anche con la validazione della form dei documenti (provare per credere).</p>
</div>

	<div class="section"><h2>Scaffolding dell'entit&#xe0; Editor<a name="Scaffolding_dellentit_Editor"></a></h2>
		<p>Dato il modello sintetizzato in analisi:</p>
		<div class="img width50">
			<img src="../../images/editor_UML.png" alt="Editor - Struttura." />
			<div class="title"><b>[Fig.3]</b> Editor - Struttura.</div>
		</div>
		<p>Creiamo le risorse ad esso legate analogamente a prima:</p>
		<div class="console">
			rails g scaffold editor name:string
		</div>
		<p>Non abbiamo ancora idea di quali propriet&#xe0; saranno significative per un <i>editor</i>, quindi per gliene diamo solo una che ci pare ragionevole, il nome: saremo sempre in tempo, in un secondo tempo, a rivedere le nostre scelte.</p>
	</div>
	
	<div class="section"><h2>Creazione relazioni fra Documento ed Editor<a name="Creazione_relazioni_fra_Documento_ed_Editor"></a></h2>
		<p>Da precedente analisi:</p>
		<div class="img width50">
			<img src="../../images/documento_UML.png" alt="Documento / Editor - Relazione." />
			<div class="title"><b>[Fig.4]</b> Documento / Editor - Relazione.</div>
		</div>
		<p>un documento:</p>
		<ul>
			<li><b>appartiene ad un</b> <i>creator</i> di tipo <i>editor</i>, obbligatorio.</li>
			<li><b>appartiene ad un</b> <i>revisor</i> di tipo <i>editor</i>, facoltativo.</li>
		</ul>
		<p>Imponiamo la relazione sul modello Rails:</p>
		<div class="filename">app/models/document.rb</div>
		<table border="0" class="CodeRay"><tbody><tr class="a">
  <td class="line_numbers"><div><pre><a href="#n1">1</a>
<a href="#n2">2</a>
<a href="#n3">3</a>
<a href="#n4">4</a>
<a href="#n5">5</a>
</pre></div></td>
  <td class="code"><div><pre><span class="r" title="Reserved">class</span> <span class="cl" title="Class">Document</span> <span title="Operator">&lt;</span> <span class="co" title="Constant">ActiveRecord</span><span title="Operator">::</span><span class="co" title="Constant">Base</span>
  <span title="Ident">belongs_to</span> <span class="sy" title="Symbol">:creator</span><span title="Operator">,</span> <span class="sy" title="Symbol">:class_name</span> <span title="Operator">=</span><span title="Operator">&gt;</span> <span class="s" title="String"><span class="dl" title="Delimiter">'</span><span class="k" title="Content">Editor</span><span class="dl" title="Delimiter">'</span></span>
  <span title="Ident">belongs_to</span> <span class="sy" title="Symbol">:revisor</span><span title="Operator">,</span> <span class="sy" title="Symbol">:class_name</span> <span title="Operator">=</span><span title="Operator">&gt;</span> <span class="s" title="String"><span class="dl" title="Delimiter">'</span><span class="k" title="Content">Editor</span><span class="dl" title="Delimiter">'</span></span>
  <span title="Ident">validates_presence_of</span> <span title="Operator">[</span><span class="sy" title="Symbol">:body</span><span title="Operator">,</span> <span class="sy" title="Symbol">:creator_id</span><span title="Operator">]</span>
<span class="r" title="Reserved">end</span></pre></div></td>
</tr></tbody></table>
	<div class="section"><h3>Rivediamo la maschera dei documenti<a name="Rivediamo_la_maschera_dei_documenti"></a></h3>
		<p>Facciamo in modo che i campi <i>creator</i> e <i>revisor</i> siano mostrati come tendine, anzich&#xe9; come campo di testo libero:</p>
		<div class="filename">app/views/documents/_form.html.erb</div>
		<table border="0" class="CodeRay"><tbody><tr class="a">
  <td title="double click to toggle" class="line_numbers"><div><pre><a href="#npre">...</a>
<a href="#n1">18</a>
<a href="#n2">19</a>
<a href="#n3">20</a>
<a href="#n4">21</a>
<a href="#n5">22</a>
<a href="#n6">23</a>
<a href="#n7">24</a>
<a href="#n8">25</a>
<a href="#npost">...</a>
</pre></div></td>
  <td class="code"><div><pre><span>...</span>
  <span class="ta" title="Tag">&lt;div</span> <span class="an" title="Attribute Name">class</span><span title="Operator">=</span><span class="s" title="String"><span class="dl" title="Delimiter">&quot;</span><span class="k" title="Content">field</span><span class="dl" title="Delimiter">&quot;</span></span><span class="ta" title="Tag">&gt;</span>
    <span class="il" title="Inline"><span class="idl" title="Inline Delimiter">&lt;%=</span> <span title="Ident">f</span><span title="Operator">.</span><span title="Ident">label</span> <span class="sy" title="Symbol">:creator_id</span> <span class="idl" title="Inline Delimiter">%&gt;</span></span><span class="ta" title="Tag">&lt;br</span> <span class="ta" title="Tag">/&gt;</span>
    <span class="il" title="Inline"><span class="idl" title="Inline Delimiter">&lt;%=</span> <span title="Ident">f</span><span title="Operator">.</span><span title="Ident">collection_select</span> <span class="sy" title="Symbol">:creator_id</span><span title="Operator">,</span> <span class="co" title="Constant">Editor</span><span title="Operator">.</span><span title="Ident">all</span><span title="Operator">,</span> <span class="sy" title="Symbol">:id</span><span title="Operator">,</span> <span class="sy" title="Symbol">:name</span><span title="Operator">,</span> <span class="sy" title="Symbol">:include_blank</span> <span title="Operator">=</span><span title="Operator">&gt;</span> <span class="pc" title="Predefined constant">true</span> <span class="idl" title="Inline Delimiter">%&gt;</span></span>
  <span class="ta" title="Tag">&lt;/div&gt;</span>
  <span class="ta" title="Tag">&lt;div</span> <span class="an" title="Attribute Name">class</span><span title="Operator">=</span><span class="s" title="String"><span class="dl" title="Delimiter">&quot;</span><span class="k" title="Content">field</span><span class="dl" title="Delimiter">&quot;</span></span><span class="ta" title="Tag">&gt;</span>
    <span class="il" title="Inline"><span class="idl" title="Inline Delimiter">&lt;%=</span> <span title="Ident">f</span><span title="Operator">.</span><span title="Ident">label</span> <span class="sy" title="Symbol">:revisor_id</span> <span class="idl" title="Inline Delimiter">%&gt;</span></span><span class="ta" title="Tag">&lt;br</span> <span class="ta" title="Tag">/&gt;</span>
    <span class="il" title="Inline"><span class="idl" title="Inline Delimiter">&lt;%=</span> <span title="Ident">f</span><span title="Operator">.</span><span title="Ident">collection_select</span> <span class="sy" title="Symbol">:revisor_id</span><span title="Operator">,</span> <span class="co" title="Constant">Editor</span><span title="Operator">.</span><span title="Ident">all</span><span title="Operator">,</span> <span class="sy" title="Symbol">:id</span><span title="Operator">,</span> <span class="sy" title="Symbol">:name</span><span title="Operator">,</span> <span class="sy" title="Symbol">:include_blank</span> <span title="Operator">=</span><span title="Operator">&gt;</span> <span class="pc" title="Predefined constant">true</span> <span class="idl" title="Inline Delimiter">%&gt;</span></span>
  <span class="ta" title="Tag">&lt;/div&gt;</span>
<span>...</span></pre></div></td>
</tr></tbody></table>
	</div>
	</div>
	
  

      </div>
    </div>
    <div class="clear">
      <hr/>
    </div>
    <div id="footer">
      <div class="xright">Copyright &#169;                   2010.
          All Rights Reserved.      
        
      </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
  </body>
</html>
